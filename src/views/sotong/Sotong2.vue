<script setup>
import { ref, computed } from "vue";

// íƒœê·¸ ì •ë³´
const tags = ref([{ name: "â­â­â­â­â­" }]);

// ìƒí’ˆ ëª©ë¡
const products = ref([
  {
    name: "ê¹€ì² ìˆ˜",
    image: "/images/cr/st_review01.jpg",
    content: "ì •ë§ ì¹œì ˆí•˜ê³  ë¹ ë¥¸ ì„œë¹„ìŠ¤ì˜€ìŠµë‹ˆë‹¤.",
  },
  {
    name: "ì´ì˜í¬",
    image: "/images/cr/st_review02.jpg",
    content: "ì‚¬ìš©ë²•ë„ ì‰¬ì›Œì„œ ìì£¼ ì´ìš©í•  ê²ƒ ê°™ì•„ìš”.",
  },
  {
    name: "ë°•ì§€í›ˆ",
    image: "/images/cr/st_review03.jpg",
    content: "ê¸°ëŒ€ ì´ìƒìœ¼ë¡œ ë§Œì¡±ìŠ¤ëŸ¬ì› ìŠµë‹ˆë‹¤!",
  },
  {
    name: "ìµœë¯¼ìˆ˜",
    image: "/images/cr/st_review04.jpg",
    content: "ì§ì›ë¶„ë“¤ì´ ë„ˆë¬´ ì¹œì ˆí–ˆì–´ìš”.",
  },
  {
    name: "ì¥ì„œì—°",
    image: "/images/cr/st_review05.jpg",
    content: "ì²˜ìŒ ì´ìš©í•´ë´¤ëŠ”ë° ì¢‹ë„¤ìš”.",
  },
  {
    name: "í•œê°€ì€",
    image: "/images/cr/st_review06.jpg",
    content: "ë°°ì†¡ì´ ì •í™•í•˜ê³  ë¹ ë¦…ë‹ˆë‹¤.",
  },
  {
    name: "ì •ìš°ì„±",
    image: "/images/cr/st_review07.jpg",
    content: "ë§¤ìš° ë§Œì¡±í•©ë‹ˆë‹¤. ë‹¤ìŒì—ë„ ë˜ ì´ìš©í• ê²Œìš”.",
  },
  {
    name: "ì†ì˜ˆì§„",
    image: "/images/cr/st_review08.jpg",
    content: "ì¹œêµ¬ì—ê²Œë„ ì¶”ì²œí•˜ê³  ì‹¶ì„ ì •ë„ì˜ˆìš”.",
  },
  {
    name: "ìœ ì¬ì„",
    image: "/images/cr/st_review09.jpg",
    content: "ì •í™•í•˜ê³  ë¹ ë¥¸ ì„œë¹„ìŠ¤ì— ê°ë™ë°›ì•˜ìŠµë‹ˆë‹¤.",
  },
  {
    name: "ê°•í˜¸ë™",
    image: "/images/cr/st_review10.jpg",
    content: "ê°„í¸í•˜ê²Œ ì˜ˆì•½í•  ìˆ˜ ìˆì–´ì„œ ì¢‹ì•˜ì–´ìš”.",
  },
  {
    name: "ì‹ ë™ì—½",
    image: "/images/cr/st_review11.jpg",
    content: "ì „ì²´ì ìœ¼ë¡œ ë§Œì¡±ìŠ¤ëŸ¬ìš´ ê²½í—˜ì´ì—ˆìŠµë‹ˆë‹¤.",
  },
  {
    name: "ì´íš¨ë¦¬",
    image: "/images/cr/st_review12.jpg",
    content: "ì •ë§ í¸ë¦¬í•˜ê²Œ ì´ìš©í•  ìˆ˜ ìˆì—ˆì–´ìš”.",
  },
  {
    name: "í™ê¸¸ë™",
    image: "/images/cr/st_review13.jpg",
    content: "ì„¤ëª…ë„ ìì„¸í•˜ê³  ë¬¸ì˜ë„ ì˜ ì‘ëŒ€í•´ì£¼ì…¨ì–´ìš”.",
  },
  {
    name: "ì´ìˆ˜ë¦¬",
    image: "/images/cr/st_review14.jpg",
    content: "ì²˜ìŒì—” ê±±ì •í–ˆì§€ë§Œ ê²°ê³¼ì ìœ¼ë¡œ ë§Œì¡±!",
  },
  {
    name: "ë°•ì •ì‹",
    image: "/images/cr/st_review15.jpg",
    content: "ì›í•˜ëŠ” ë‚ ì§œì— ì •í™•íˆ ë„ì°©í–ˆì–´ìš”.",
  },
  {
    name: "ìµœê°€ì„",
    image: "/images/cr/st_review16.jpg",
    content: "ì˜ˆìƒë³´ë‹¤ ë¹ ë¥´ê²Œ ì²˜ë¦¬ë¼ì„œ ë†€ëì–´ìš”.",
  },
  {
    name: "ì¥ì„±ê·œ",
    image: "/images/cr/st_review17.jpg",
    content: "ì‹œìŠ¤í…œì´ ì˜ ë˜ì–´ ìˆì–´ì„œ í¸ë¦¬í•©ë‹ˆë‹¤.",
  },
  {
    name: "í•œë™ì¤€",
    image: "/images/cr/st_review18.jpg",
    content: "ì˜ˆì•½ë¶€í„° ìˆ˜ë ¹ê¹Œì§€ ì „í˜€ ë¶ˆí¸í•¨ì´ ì—†ì—ˆì–´ìš”.",
  },
  {
    name: "ì •ìœ ë¦¬",
    image: "/images/cr/st_review19.jpg",
    content: "ê°„ë‹¨í•œ ì ˆì°¨ë¡œ ì‰½ê²Œ ì™„ë£Œí•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.",
  },
  {
    name: "ì†ì„êµ¬",
    image: "/images/cr/st_review20.jpg",
    content: "ê¸°ëŒ€í•˜ì§€ ì•Šì•˜ëŠ”ë° ì„œë¹„ìŠ¤ ì¢‹ì•„ìš”!",
  },
  {
    name: "ì´ë¯¸ì •",
    image: "/images/cr/st_review21.jpg",
    content: "ì§ê´€ì ì¸ UI ë•ë¶„ì— ì‰½ê²Œ ì˜ˆì•½í–ˆìŠµë‹ˆë‹¤.",
  },
  {
    name: "ê°•ë™ì‹",
    image: "/images/cr/st_review22.jpg",
    content: "ìì„¸í•œ ì„¤ëª…ê³¼ ë¹ ë¥¸ í”¼ë“œë°±ì´ ì¢‹ì•˜ì–´ìš”.",
  },
  {
    name: "ì‹ ë‚˜ë¼",
    image: "/images/cr/st_review23.jpg",
    content: "ì„œë¹„ìŠ¤ê°€ ë„ˆë¬´ ì¢‹ì•„ì„œ ë‹¤ìŒì—ë„ ì´ìš©í•  ìƒê°ì…ë‹ˆë‹¤.",
  },
  {
    name: "ì´ì•„ì •",
    image: "/images/cr/st_review24.jpg",
    content: "ë°°ì†¡ì´ ì˜ˆìƒë³´ë‹¤ ë¹¨ë¼ì„œ ê¸°ë¶„ ì¢‹ì•˜ì–´ìš”.",
  },
]);

// ì´ë¦„ ë§ˆìŠ¤í‚¹ (ex: í™ê¸¸ë™ â†’ í™**)
const maskedName = (name) => name.charAt(0) + "*".repeat(name.length - 1);

// í˜ì´ì§€ë„¤ì´ì…˜ ìƒíƒœ
const currentPage = ref(1);
const itemsPerPage = 8; // í•œ í˜ì´ì§€ë‹¹ 8ê°œ ìƒí’ˆ í‘œì‹œ

// ì´ í˜ì´ì§€ ìˆ˜ ê³„ì‚°
const totalPages = computed(() =>
  Math.ceil(products.value.length / itemsPerPage)
);

// í˜„ì¬ í˜ì´ì§€ì— ë§ëŠ” ìƒí’ˆ ëª©ë¡ ë°˜í™˜
const paginatedProducts = computed(() => {
  const start = (currentPage.value - 1) * itemsPerPage;
  return products.value.slice(start, start + itemsPerPage);
});

// í˜ì´ì§€ ì´ë™ í•¨ìˆ˜
const prevPage = () => {
  if (currentPage.value > 1) currentPage.value--;
};
const nextPage = () => {
  if (currentPage.value < totalPages.value) currentPage.value++;
};
const showForm = ref(false);
const newReview = ref({
  name: "",
  content: "",
  image: "",
});
const previewImage = ref("");

// ë“±ë¡ëœ í›„ê¸° ëª©ë¡
const reviews = ref([]);

// í›„ê¸° ì¶”ê°€
const addReview = () => {
  if (!newReview.value.name || !newReview.value.content) {
    alert("ì´ë¦„ê³¼ í›„ê¸°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.");
    return;
  }
  const newItem = {
    name: newReview.value.name,
    image: newReview.value.image || "/images/default-user.png",
  };
  // products ëª©ë¡ ì•ì— ì¶”ê°€
  products.value.unshift(newItem);
  cancelForm();
};

// ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
const handleImageUpload = (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    previewImage.value = reader.result;
    newReview.value.image = reader.result;
  };
  reader.readAsDataURL(file);
};

const cancelForm = () => {
  newReview.value = { name: "", content: "", image: "" };
  previewImage.value = "";
  showForm.value = false;
};
//ëª¨ë‹¬
const showModal = ref(false);
const selectedReview = ref(null);

const openModal = (review) => {
  selectedReview.value = review;
  showModal.value = true;
};

const closeModal = () => {
  selectedReview.value = null;
  showModal.value = false;
};
</script>

<template>
  <div class="st_wrap">
    <div class="st_title1">
      <!-- ì œëª© -->
      <div class="title_txt1">
        <h1>ì´ìš©í›„ê¸°</h1>
      </div>
    </div>

    <!-- ë¦¬ë·° ë°°ë„ˆ -->
    <div class="st_reviewbanner">
      <img src="/images/cr/st_reviewbanner.jpg" alt="ë¦¬ë·°ì´ë²¤íŠ¸" />
    </div>

    <!-- ì¹´ë“œì´ìš©í›„ê¸° -->
    <div class="st_bottom">
      <div class="st_card-container">
        <div
          class="st_card"
          v-for="product in paginatedProducts"
          :key="product.image"
          @click="openModal(product)">
          <div class="st_img-product">
            <img :src="product.image" alt="Product" />
          </div>
          <div class="st_detail">
            <div class="st_title">
              <div class="st_tag">
                <a v-for="tag in tags" :href="tag.link" :key="tag.name">
                  <span>{{ tag.name }}</span>
                </a>
              </div>
              <h5>
                âœ¨{{ maskedName(product.name) }}âœ¨ë‹˜ì˜<br />ì´ìš©í›„ê¸°ì…ë‹ˆë‹¤ğŸ˜Š
              </h5>
            </div>
          </div>
        </div>
      </div>
      <div class="write-btn-wrapper">
      <!-- ê¸€ì“°ê¸° ë²„íŠ¼ -->
      <button @click="showForm = !showForm" class="write-btn">
        {{ showForm ? "ì·¨ì†Œ" : "ê¸€ì“°ê¸°" }}
      </button>

      <!-- ê¸€ì“°ê¸° í¼ -->
      <form v-if="showForm" class="review-form">
        <input type="text" v-model="newReview.name" placeholder="ì´ë¦„" />
        <textarea v-model="newReview.content" placeholder="í›„ê¸°ë‚´ìš©"></textarea>
        <input type="file" @change="handleImageUpload" accept="image/*" />
        <img v-if="previewImage" :src="previewImage" width="120" />
        <div class="form-buttons">
          <button type="button" @click="addReview">ë“±ë¡</button>
          <button type="button" @click="cancelForm">ì·¨ì†Œ</button>
        </div>
      </form>
    </div>
      <!-- í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ -->
      <div class="st_pagination">
        <button @click="prevPage" :disabled="currentPage === 1">ì´ì „</button>
        <span>{{ currentPage }} / {{ totalPages }}</span>
        <button @click="nextPage" :disabled="currentPage === totalPages">
          ë‹¤ìŒ
        </button>
      </div>
    </div>
  </div>
  <!-- ëª¨ë‹¬ì°½ ë‚´ìš© -->
  <div class="st_modal">
    <div v-if="showModal" class="modal-overlay" @click.self="closeModal">
      <div class="modal-content">
        <h3>âœ¨{{ maskedName(selectedReview.name) }}ë‹˜ì˜ ì´ìš©í›„ê¸°âœ¨</h3>
        <img :src="selectedReview.image" alt="í›„ê¸° ì´ë¯¸ì§€" />
        <p><strong></strong> {{ selectedReview.content || "ë‚´ìš© ì—†ìŒ" }}</p>
        <button @click="closeModal">ë‹«ê¸°</button>
      </div>
    </div>
  </div>
</template>

<style lang="scss" scoped>
@use "@/assets/Main.scss" as *;
@use "@/assets/_Variables.scss" as *;

.st_wrap {
  width: 700px;
  margin: 100px auto;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  font-family: $font-family;
}

.st_title1 {
  display: flex;
  gap: 10px;
  line-height: 40px;
  flex-wrap: wrap; /* ë„˜ì¹˜ë©´ ìë™ ì¤„ë°”ê¿ˆ */
  align-items: center; /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
  justify-content: center; /* ê°€ë¡œ ì¤‘ì•™ ì •ë ¬ */
  padding-bottom: 10px;
  .st_titleLine {
    width: 3px;
    height: 25px;
    background-color: $main-color;
  }
  .title_txt1 h1 {
    font-size: 25px;
  }
}
// ë¦¬ë·° ë°°ë„ˆ
.st_reviewbanner {
  justify-content: center;
  margin-bottom: $margin-L;
}

img {
  width: 90%;
  height: 90%;
}

// ë¦¬ë·° ì¹´ë“œ
.st_card-container {
  width: 800px;
  display: flex;
  justify-content: center;
  gap: 20px;
  flex-wrap: wrap;
  font-family: none;
}

.st_card {
  width: 180px;
  height: 300px;
  border: 1px solid #ccc;
  border-radius: 10px;
  transition: transform 0.3s ease-in-out;
}

.st_card:hover {
  border: 2px solid $sub-color;
  box-shadow: 2px 2px $sub-color;
  transform: scale(1.1);
}

.st_card .st_img-product {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 70%;
}

.st_card .st_img-product img {
  height: 90%;
  width: 90%;
  border-radius: 10px;
}

.st_detail {
  height: 30%;
  padding-left: 5px;
}

.st_title {
  display: flex;
  flex-wrap: wrap;
  text-align: left;
}

h5 {
  margin-top: 10px;
  line-height: 20px;
}

.st_tag a {
  padding: 5px auto;
  font-size: 12px;
  color: black;
  background-color: #dedfdf;
  border-radius: 20px;
  text-decoration: none;
}

/* í˜ì´ì§€ë„¤ì´ì…˜ ìŠ¤íƒ€ì¼ */
.st_pagination {
  margin-top: 20px;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
}

.st_pagination button {
  padding: 5px 10px;
  margin: 0 5px;
  cursor: pointer;
  border: none;
  border-radius: 5px;
  background-color: $sub-color;
  color: #fff;
}

.st_pagination button:disabled {
  background-color: #ccc;
  cursor: not-allowed;
}
/* ê¸€ì“°ê¸° ë²„íŠ¼ */
.write-btn-wrapper {
  width: 100%;
  display: flex;
  flex-direction: column;
  align-content: flex-end;
  align-items: flex-end;
  margin-bottom: 20px;
}

.write-btn {
  padding: 8px 16px;
  margin: 10px;
  background-color: $main-color;
  width: 100px;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

.review-form {
  display: flex;
  flex-direction: column;
  gap: 10px;
  width: 100%;
  max-width: 500px;
  margin-bottom: 30px;
}

.review-form input,
.review-form textarea {
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 5px;
}

.form-buttons {
  display: flex;
  gap: 10px;
  justify-content: center;
}
.st_modal {
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.4);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 999;
  }

  .modal-content {
    background: white;
    padding: 20px;
    border-radius: 12px;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
    text-align: center;

    img {
      width: 100%;
      border-radius: 10px;
      margin: 10px 0;
    }

    button {
      margin-top: 10px;
      background-color: $sub-color;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
    }
  }
}
@media (max-width: 390px) {
  .st_wrap {
    width: 100%;
    margin: 100px auto;
    padding: 0 16px;
  }

  .st_card-container {
    width: 100%;
    gap: 12px;
    justify-content: center;
  }

  .st_card {
    width: 45%;
    height: 260px;
  }

  .st_card .st_img-product img {
    width: 100%;
    height: 100%;
  }

  .title_txt1 h1 {
    font-size: 25px;
  }

  .write-btn {
    width: 80px;
    font-size: 14px;
    padding: 6px 12px;
  }

  .review-form {
    width: 100%;
  }

  .review-form input,
  .review-form textarea {
    font-size: 14px;
  }

  .st_pagination {
    flex-direction: column;
    gap: 6px;
  }

  .modal-content {
    width: 90%;
    font-size: 14px;

    img {
      max-height: 200px;
      object-fit: contain;
    }

    button {
      font-size: 14px;
      padding: 6px 12px;
    }
  }
}
</style>
